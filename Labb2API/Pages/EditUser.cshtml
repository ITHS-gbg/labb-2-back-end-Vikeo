@page
@model Labb2API.Pages.EditUserModel
@{
}

<form method="post">
    <div class="form-group">
        <label asp-for="SelectedUser">Users</label>
        <select id="selectedUser" class="form-control form-select">
            <option disabled selected>Select</option>
            @foreach (var user in @Model.Users)
            {
                <option value="@user.Email"> @user.Email (@user.Id)</option>
            }
            <label asp-for="SelectedUser.FirstName">First Name</label>
            <input type="text" id="firstName" class="form-control form-text" asp-for="SelectedUser.FirstName" value="">

            <label asp-for="SelectedUser.LastName">Last Name</label>
            <input type="text" id="lastName" class="form-control form-text" asp-for="SelectedUser.LastName" value="">

            <label asp-for="SelectedUser.Email">Email</label>
            <input type="text" id="email" class="form-control form-text" asp-for="SelectedUser.Email" value="">

            <label asp-for="SelectedUser.Phone">Phone</label>
            <input type="text" id="phone" class="form-control form-text" asp-for="SelectedUser.Phone" value="">

            <label asp-for="SelectedUser.Address">Address</label>
            <input type="text" id="address" class="form-control form-text" asp-for="SelectedUser.Address" value="">
        </select>
    </div>
    <button type="submit" class="btn btn-primary mt-3">Submit</button>
</form>

<div class="text-center">
    <table id="activeCoursesTable" class="table table-hover mt-2">
        <thead class="table-dark">
        <tr>
            <th>Id</th>
            <th>Title</th>
            <th>Description</th>
            <th>Duration</th>
            <th>Difficulty</th>
            <th>Active</th>
            <th>Buttons</th>
        </tr>
        </thead>
        </table>
</div>

<script>
    var selectedUserHtml = document.getElementById("selectedUser");
    
    selectedUserHtml.addEventListener('change', (e) => {
  console.log(`e.target.value = ${ e.target.value }`);
  
  fetch(`/controller/users/${e.target.value}`)
      .then(response => response.json())
      .then(data => {
          console.log(data);
          document.getElementById("email").readOnly = true; //TODO Readonly just nu, fixa email
          document.getElementById("firstName").value = data.FirstName;
          document.getElementById("lastName").value = data.LastName;
          document.getElementById("email").value = data.Email;
          document.getElementById("phone").value = data.Phone;
          document.getElementById("address").value = data.Address;

          const table = document.getElementById("activeCoursesTable");
          if (data.ActiveCourses.length <= 0) {
              table.innerHTML = `<div>Den här användaren har ingen kurs registrerad.</div>`;
          } else {
              table.innerHTML = `<table id="activeCoursesTable" class="table table-hover mt-2">
                                 <thead class="table-dark">
                                 <tr>
                                     <th>Id</th>
                                     <th>Title</th>
                                     <th>Description</th>
                                     <th>Duration</th>
                                     <th>Difficulty</th>
                                     <th>Active</th>
                                     <th>Buttons</th>
                                 </tr>
                                 </thead>
                             </table>`;
              data.ActiveCourses.forEach(course => {
                  console.log(course);
                  const tr = document.createElement("tr");
                  const td1 = document.createElement("td");
                  td1.innerText = course.Id;
                  const td2 = document.createElement("td");
                  td2.innerText = course.Title;
                  const td3 = document.createElement("td");
                  td3.innerText = course.Description;
                  const td4 = document.createElement("td");
                  td4.innerText = course.Duration;
                  const td5 = document.createElement("td");
                  td5.innerText = course.Difficulty;
                  const td6 = document.createElement("td");
                  td6.innerText = course.Status;
                  const tdButtons = document.createElement("td");

                  tr.appendChild(td1);
                  tr.appendChild(td2);
                  tr.appendChild(td3);
                  tr.appendChild(td4);
                  tr.appendChild(td5);
                  tr.appendChild(td6);
                  tr.appendChild(tdButtons);

                  table.appendChild(tr);
              });
          }
              

          
      });

});

</script>